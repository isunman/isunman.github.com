<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Sunman，太阳侠" />





  <link rel="alternate" href="/atom.xml" title="太阳侠" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="love IT, love Movie, love Love">
<meta property="og:type" content="website">
<meta property="og:title" content="太阳侠">
<meta property="og:url" content="http://isunman.com/page/6/index.html">
<meta property="og:site_name" content="太阳侠">
<meta property="og:description" content="love IT, love Movie, love Love">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="太阳侠">
<meta name="twitter:description" content="love IT, love Movie, love Love">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: undefined,
      author: '博主'
    }
  };
</script>

  <title> 太阳侠 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?edc09d74f003ef7b14a37137efc44fd4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">太阳侠</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">我是一颗恒星</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/How-to-solve-the-spike-performance-issues-and-oversold-discussions/" itemprop="url">
                  如何解决秒杀的性能问题和超卖的讨论
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术日记/" itemprop="url" rel="index">
                    <span itemprop="name">技术日记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近业务试水电商，接了一个秒杀的活。之前经常看到淘宝的同行们讨论秒杀，讨论电商，这次终于轮到我们自己理论结合实际一次了。</p>
<p>ps：进入正文前先说一点个人感受，之前看淘宝的ppt感觉都懂了，等到自己出解决方案的时候发现还是有很多想不到的地方其实都没懂，再次验证了“细节是魔鬼”的理论。并且一个人的能力有限，只有大家一起讨论才能想的更周全，更细致。好了，闲话少说，下面进入正文。</p>
<h2 id="一、秒杀带来了什么？"><a href="#一、秒杀带来了什么？" class="headerlink" title="一、秒杀带来了什么？"></a>一、秒杀带来了什么？</h2><p>秒杀或抢购活动一般会经过【预约】【抢订单】【支付】这3个大环节，而其中【抢订单】这个环节是最考验业务提供方的抗压能力的。</p>
<p>抢订单环节一般会带来2个问题：</p>
<h3 id="1、高并发"><a href="#1、高并发" class="headerlink" title="1、高并发"></a>1、高并发</h3><p>比较火热的秒杀在线人数都是10w起的，如此之高的在线人数对于网站架构从前到后都是一种考验。</p>
<h3 id="2、超卖"><a href="#2、超卖" class="headerlink" title="2、超卖"></a>2、超卖</h3><p>任何商品都会有数量上限，如何避免成功下订单买到商品的人数不超过商品数量的上限，这是每个抢购活动都要面临的难题。</p>
<h2 id="二、如何解决？"><a href="#二、如何解决？" class="headerlink" title="二、如何解决？"></a>二、如何解决？</h2><p>首先，产品解决方案我们就不予讨论了。我们只讨论技术解决方案</p>
<h3 id="1、前端"><a href="#1、前端" class="headerlink" title="1、前端"></a>1、前端</h3><p>面对高并发的抢购活动，前端常用的三板斧是【扩容】【静态化】【限流】</p>
<p>　　<strong>A：扩容</strong></p>
<p>　　加机器，这是最简单的方法，通过增加前端池的整体承载量来抗峰值。</p>
<p>　　<strong>B：静态化</strong></p>
<p>　　将活动页面上的所有可以静态的元素全部静态化，并尽量减少动态元素。通过CDN来抗峰值。</p>
<p>　　<strong>C：限流</strong></p>
<p>　　一般都会采用IP级别的限流，即针对某一个IP，限制单位时间内发起请求数量。</p>
<p>　　或者活动入口的时候增加游戏或者问题环节进行消峰操作。</p>
<p>　　<strong>D：有损服务</strong></p>
<p>　　最后一招，在接近前端池承载能力的水位上限的时候，随机拒绝部分请求来保护活动整体的可用性。</p>
<h3 id="2、后端"><a href="#2、后端" class="headerlink" title="2、后端"></a>2、后端</h3><p>那么后端的数据库在高并发和超卖下会遇到什么问题呢？主要会有如下3个问题：（主要讨论写的问题，读的问题通过增加cache可以很容易的解决）</p>
<p>　　I：　首先MySQL自身对于高并发的处理性能就会出现问题，一般来说，MySQL的处理性能会随着并发thread上升而上升，但是到了一定的并发度之后会出现明显的拐点，之后一路下降，最终甚至会比单thread的性能还要差。</p>
<p>　　II： 其次，超卖的根结在于减库存操作是一个事务操作，需要先select，然后insert，最后update -1。最后这个-1操作是不能出现负数的，但是当多用户在有库存的情况下并发操作，出现负数这是无法避免的。</p>
<p>　　III：最后，当减库存和高并发碰到一起的时候，由于操作的库存数目在同一行，就会出现争抢InnoDB行锁的问题，导致出现互相等待甚至死锁，从而大大降低MySQL的处理性能，最终导致前端页面出现超时异常。</p>
<p>针对上述问题，如何解决呢？ 我们先看眼淘宝的高大上解决方案：</p>
<p>　　I：  关闭死锁检测，提高并发处理性能。</p>
<p>　　II：修改源代码，将排队提到进入引擎层前，降低引擎层面的并发度。</p>
<p>　　III：组提交，降低server和引擎的交互次数，降低IO消耗。</p>
<p>以上内容可以参考丁奇在DTCC2013上分享的《秒杀场景下MySQL的低效》一文。在文中所有优化都使用后，TPS在高并发下，从原始的150飙升到8.5w，提升近566倍，非常吓人！！！</p>
<p>不过结合我们的实际，改源码这种高大上的解决方案显然有那么一点不切实际。于是小伙伴们需要讨论出一种适合我们实际情况的解决方案。以下就是我们讨论的解决方案：</p>
<p>首先设定一个前提，为了防止超卖现象，所有减库存操作都需要进行一次减后检查，保证减完不能等于负数。（由于MySQL事务的特性，这种方法只能降低超卖的数量，但是不可能完全避免超卖）</p>
<pre><code>update number set x=x-1 where (x -1 ) &gt;= 0;
</code></pre><h4 id="解决方案1："><a href="#解决方案1：" class="headerlink" title="解决方案1："></a>解决方案1：</h4><p>将存库从MySQL前移到Redis中，所有的写操作放到内存中，由于Redis中不存在锁故不会出现互相等待，并且由于Redis的写性能和读性能都远高于MySQL，这就解决了高并发下的性能问题。然后通过队列等异步手段，将变化的数据异步写入到DB中。</p>
<p>优点：解决性能问题</p>
<p>缺点：没有解决超卖问题，同时由于异步写入DB，存在某一时刻DB和Redis中数据不一致的风险。</p>
<h4 id="解决方案2："><a href="#解决方案2：" class="headerlink" title="解决方案2："></a>解决方案2：</h4><p>引入队列，然后将所有写DB操作在单队列中排队，完全串行处理。当达到库存阀值的时候就不在消费队列，并关闭购买功能。这就解决了超卖问题。</p>
<p>优点：解决超卖问题，略微提升性能。</p>
<p>缺点：性能受限于队列处理机处理性能和DB的写入性能中最短的那个，另外多商品同时抢购的时候需要准备多条队列。</p>
<h4 id="解决方案3："><a href="#解决方案3：" class="headerlink" title="解决方案3："></a>解决方案3：</h4><p>将写操作前移到MC中，同时利用MC的轻量级的锁机制CAS来实现减库存操作。</p>
<p>优点：读写在内存中，操作性能快，引入轻量级锁之后可以保证同一时刻只有一个写入成功，解决减库存问题。</p>
<p>缺点：没有实测，基于CAS的特性不知道高并发下是否会出现大量更新失败？不过加锁之后肯定对并发性能会有影响。</p>
<h4 id="解决方案4："><a href="#解决方案4：" class="headerlink" title="解决方案4："></a>解决方案4：</h4><p>将提交操作变成两段式，先申请后确认。然后利用Redis的原子自增操作（相比较MySQL的自增来说没有空洞），同时利用Redis的事务特性来发号，保证拿到小于等于库存阀值的号的人都可以成功提交订单。然后数据异步更新到DB中。</p>
<p>优点：解决超卖问题，库存读写都在内存中，故同时解决性能问题。</p>
<p>缺点：由于异步写入DB，可能存在数据不一致。另可能存在少买，也就是如果拿到号的人不真正下订单，可能库存减为0，但是订单数并没有达到库存阀值。</p>
<h2 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h2><p><strong>1、前端三板斧【扩容】【限流】【静态化】</strong></p>
<p><strong>2、后端两条路【内存】+【排队】</strong></p>
<h2 id="四、非技术感想"><a href="#四、非技术感想" class="headerlink" title="四、非技术感想"></a>四、非技术感想</h2><p>1、团队的力量是无穷的，各种各样的解决方案（先不谈可行性）都是在小伙伴们七嘴八舌中讨论出来的。我们需要让所有人都发出自己的声音，不要着急去否定。</p>
<p>2、优化需要从整体层面去思考，不要只纠结于自己负责的部分，如果只盯着一个点思考，最后很可能就走进死胡同中了。</p>
<p>3、有很多东西以为读过了就懂了，其实不然。依然还是需要实践，否则别人的知识永远不可能变成自己的。</p>
<p>4、多思考为什么，会发生什么，不要想当然。只有这样才能深入进去，而不是留在表面。</p>
<p>ps：以上仅仅是我们讨论的一些方案设想，欢迎大家一起讨论各种可行方案。 </p>
<p><a href="http://www.cnblogs.com/billyxp/p/3701124.html" target="_blank" rel="external">原文链接</a></p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/How-to-use-the-watch-star-and-fork-in-github/" itemprop="url">
                  如何用好 github 中的 watch、star、fork
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/工作学习/" itemprop="url" rel="index">
                    <span itemprop="name">工作学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在每个 github 项目的右上角，都有三个按钮,分别是 watch、star、fork，但是有些刚开始使用 github 的同学，可能对这三个按钮的使用却不怎么了解，包括一开始使用 github 的我也是如此。这篇博客，结合自的理解和使用，说说这三个按钮的用法以及一些个人见解。</p>
<p>从左至右，依次是 watch star fork，下面分别说下他们的具体作用。</p>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>watch 翻译过来可以称之为观察，点击 watch 可以看到如下的列表。</p>
<p>对于别人的项目，默认自己都处于 Not watching 的状态，当你选择 Watching，表示你以后会关注这个项目的所有动态，这个项目以后只要发生变动，如被别人提交了 pull request、被别人发起了issue等等情况，你都会在自己的个人通知中心，收到一条通知消息，如果你设置了个人邮箱，那么你的邮箱也可能收到相应的邮件。</p>
<p>如下，我 watching 了开源项目android-cn/android-discuss，那么以后任何人只要在这个项目下提交了 issue 或者在 issue 下面有任何留言，我的通知中心就会通知我。如果你配置了邮箱，你还可能会因此不断的收到通知邮件。</p>
<p>如果你不想接受这个项目的所有通知，那么点击 Not Watching 即可。</p>
<p>另外这里有一篇文章讲 如何正确接收 GitHub 的消息邮件，很不错的一篇文章，推荐大家看看。</p>
<h2 id="star"><a href="#star" class="headerlink" title="star"></a>star</h2><p>star 翻译过来是星，但这个翻译没任何具体意义，这里解释为关注或者点赞更合适，当你点击 star，表示你喜欢这个项目或者通俗点，可以把他理解成朋友圈的点赞吧，表示对这个项目的支持。</p>
<p>不过相比朋友圈的点赞，github 里面会有一个列表，专门收集了你所有 star 过的项目，点击 github 个人头像，可以看到 your stars 的条目，点击就可以查看你 star 过的所有项目了，如下图所示</p>
<p>不过，star 列表很容易出现这样的问题：如果你平时比较爱逛 Github， star 的项目过多后怎么快速查找自己想要的项目怎么办？</p>
<p>这时，如果 github 可以提供一个分类功能该多好，就像微信公众号文章的收藏，你在点击微信菜单中的收藏后，微信会提示你对收藏的文章设置 tag。这样设置的好处是，以后在微信收藏列表中查找项目时，可以根设置的 tag 归类查找，这样查找效率会提高不少。</p>
<p>但是不知道 github 的产品经理是怎么想的，github 本身没有这个功能。但是 github 这个全球最大的程序员社区从来也不缺有思想有执行力的程序员。</p>
<p>也许是 github 自己也发现了检索的问题，现在 github 增加了一个类似的功能，可以给自己给自己的项目设置 topic.<br>给自己的项目设置 topic 后，相当于自己给自己的项目设置了一个 tag ，这样可以方便别人搜索。比如要搜索所有 topic 为 android 的项目，你只需要在 GitHub 搜索时输入 topic android  然后搜索即可。</p>
<h2 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h2><p>当选择 fork，相当于你自己有了一份原项目的拷贝，当然这个拷贝只是针对当时的项目文件，如果后续原项目文件发生改变，你必须通过其他的方式去同步。</p>
<p>一般来说，我们不需要使用 fork 这个功能，除非有一些项目，可能存在 bug 或者可以继续优化的地方，你想帮助原项目作者去完善这个项目或者单纯的想在原来项目基础上己维护一个属于自己项目（比如我 fork 的 AndroidWeekly 客户端，那么你可以 fork 一份项目下来，然后自己对这个项目进行修改完善，当你觉得项目没问题了，你就可以尝试发起 pull request 给原项目作者了。</p>
<p>然后就静静等待他的 merge 邮件通知了。</p>
<p>我看到很多人错误的在使用 fork。很多人把 fork 当成了收藏一样的功能，包括一开始使用 github 的我，每次看到一个好的项目就先 fork，</p>
<p>因为这样，就可以我的 repository(仓库)列表下查看 fork 的项目了。其实你完全可以使用 star 来达到这个目的。</p>
<h2 id="使用建议"><a href="#使用建议" class="headerlink" title="使用建议"></a>使用建议</h2><p>1、对于一些可能会经常发生变化的会不定期更新的好项目 多使用 watch.</p>
<p>比如 android-cn 团队的 android-discuss 项目，</p>
<p>你就可以 watching 它，这里面都是一些关于 Android 技术的交流，如果有任何新问题，你都可以收到通知，你可以查看别人的回答，</p>
<p>你可以回答别人提出的问题，这是一个很好的学习成长方式。</p>
<p>其他值得watch的项目还有很多，比如 github 上很多的 Awesome 系列的项目,如 Awesome-MaterialDesign 等，你 watch 这些项目了，</p>
<p>只要项目新增一些好玩好用的东西，你就会收到通知。</p>
<p>我在知乎上看到有人问这样的问题，说 github 上有哪些值得 watch 的项目，其实有很多，我自己也整理了一些，但是没放到 github.</p>
<p>值得注意的是，如果 watch多了，你可能会被无休止的邮件通知烦死（邮件通知可设置），因为被 watch 项目有任何留言、PR等更新都会触发通知，所以做好权衡。</p>
<p>2、喜欢一个项目就 star 它吧~</p>
<p>3、修改开源项目就使用 fork，这样你就可以在原项目的基础上，对项目进行修改提交，现在你是这个项目的主人啦~</p>
<h2 id="小细节"><a href="#小细节" class="headerlink" title="小细节"></a>小细节</h2><p>有些时候，你看到一个项目的 star 数有很多，你就想知道到底都有那些人 star 了这个项目，或者 fork 了这个项目，</p>
<p>但是环顾一圈，你却找不到一个入口，后来自己不经意的发现，只要点击 star 傍边的数字，就可以查看有哪些人 star 了这个项目。</p>
<p>是不是有点意思，现在你就可以去试试，watch、fork上面的数字都是可以点击的，道理一样。</p>
<p><a href="https://www.jianshu.com/p/6c366b53ea41" target="_blank" rel="external">原文参考</a></p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/how-to-download-zhihu-video/" itemprop="url">
                  如何下载知乎视频
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络工具/" itemprop="url" rel="index">
                    <span itemprop="name">网络工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>知乎视频缓存是分段每一段几秒，不可能有完整文件可以一次下载完成的。大部分浏览器视频探测下载插件也不管用。</p>
<p>下面说一种亲测实用的方法。</p>
<h3 id="1、先找到视频的真正地址，一般都是m3u8格式。"><a href="#1、先找到视频的真正地址，一般都是m3u8格式。" class="headerlink" title="1、先找到视频的真正地址，一般都是m3u8格式。"></a>1、先找到视频的真正地址，一般都是m3u8格式。</h3><p>方法有许多种。暂时介绍2种。</p>
<p>第1种：<br>如果已经获取到形如<a href="https://v.vzuu.com/video/1018150775008034816格式的知乎视频地址，" target="_blank" rel="external">https://v.vzuu.com/video/1018150775008034816格式的知乎视频地址，</a><br>则使用<a href="https://lens.zhihu.com/api/videos/1018150775008034816来获取视频的真实地址；" target="_blank" rel="external">https://lens.zhihu.com/api/videos/1018150775008034816来获取视频的真实地址；</a><br>最后的数字是视频网页的地址中的参数，返回的json 里有 m3u8 地址。</p>
<p>第2种：<br>实用浏览器工具“代码检查”或者“查看源码”或者“firebug”，查找到视频的真实地址。</p>
<h3 id="2、实用FFmpeg命令，可以自动下载分段视频为一个完整的指定格式的文件。"><a href="#2、实用FFmpeg命令，可以自动下载分段视频为一个完整的指定格式的文件。" class="headerlink" title="2、实用FFmpeg命令，可以自动下载分段视频为一个完整的指定格式的文件。"></a>2、实用FFmpeg命令，可以自动下载分段视频为一个完整的指定格式的文件。</h3><p>需要注意的是，需要提前本地安装好ffmpeg；使用命令时，如不识别ffmpeg则需要使用ffmpeg的绝对路径。</p>
<p>ffmpeg -i “视频真实地址URL” -c copy m.mp4</p>
<p>执行完成之后，在执行命令行切换的当前目录下就是生成m.mp4的文件。
　　</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/Explanation-of-id-number/" itemprop="url">
                  身份证号码解释，附：18位公民身份证编码规则
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络工具/" itemprop="url" rel="index">
                    <span itemprop="name">网络工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="身份证号码解释，附：18位公民身份证编码规则"><a href="#身份证号码解释，附：18位公民身份证编码规则" class="headerlink" title="身份证号码解释，附：18位公民身份证编码规则"></a>身份证号码解释，附：18位公民身份证编码规则</h2><h3 id="身份证号码由18位数字组成，你知道它们代表的信息吗？"><a href="#身份证号码由18位数字组成，你知道它们代表的信息吗？" class="headerlink" title="身份证号码由18位数字组成，你知道它们代表的信息吗？"></a>身份证号码由18位数字组成，你知道它们代表的信息吗？</h3><p>其中的第一、第二数字表示公民所在地的省份（或自治区、直辖市）；第三、第四位数字表示公民所在地的市（或州）；第五、第六位数字表示公民所在地的县（或县级市）；接下来的8位数字表示公民的出生年、月、日；最后4位数字中的前两位表示当地派出所的编码；倒数第二位表示公民是男性还是女性（男性用单数，女性用双数）；最后一位数字是一个随机数，又称为校验码。</p>
<p>大陆的身份证为18位，老的身份证是15位。</p>
<h3 id="关于身份证第18是怎么计算的，原理如下"><a href="#关于身份证第18是怎么计算的，原理如下" class="headerlink" title="关于身份证第18是怎么计算的，原理如下"></a>关于身份证第18是怎么计算的，原理如下</h3><p>根据〖中华人民共和国国家标准GB11643-1999〗中有关公民身份号码的规定，公民身份号码是特征组合码，由十七位数字本体码和一位数字校验码组成。排列顺序从左至右依次为：六位数字地址码，八位数字出生日期码，三位数字顺序码和一位数字校验码。</p>
<p>地址码（身份证前六位）表示编码对象常住户口所在县(市、旗、区)的行政区划代码。（所有区域的编码可以到这个网址<a href="http://xzqh.mca.gov.cn查询到最新的县及县以上的行政编码资料。）" target="_blank" rel="external">http://xzqh.mca.gov.cn查询到最新的县及县以上的行政编码资料。）</a></p>
<p>生日期码（身份证第七位到第十四位）表示编码对象出生的年、月、日，其中年份用四位数字表示，年、月、日之间不用分隔符。例如：1981年05月11日就用19810511表示。</p>
<p>顺序码（身份证第十五位到十七位）为同一地址码所标识的区域范围内，对同年、月、日出生的人员编定的顺序号。其中第十七位奇数分给男性，偶数分给女性。</p>
<p>校验码（身份证最后一位）是根据前面十七位数字码，按照ISO7064:1983.MOD11-2校验码计算出来的检验码。</p>
<h3 id="第十八位数字的计算方法"><a href="#第十八位数字的计算方法" class="headerlink" title="第十八位数字的计算方法"></a>第十八位数字的计算方法</h3><p>1.将前面的身份证号码17位数分别乘以不同的系数。从第一位到第十七位的系数分别为：7910584216379105842</p>
<p>2.将这17位数字和系数相乘的结果相加。</p>
<p>3.用加出来和除以11，看余数是多少？</p>
<p>4.余数只可能有012345678910这11个数字。其分别对应的最后一位身份证的号码为10X98765432。</p>
<p>5.通过上面得知如果余数是2，就会在身份证的第18位数字上出现罗马数字的Ⅹ。如果余数是10，身份证的最后一位号码就是2。</p>
<p>例如：某男性的身份证号码是34052419800101001X。我们要看看这个身份证是不是合法的身份证。</p>
<p>首先：我们得出，前17位的乘积和是189</p>
<p>然后：用189除以11得出的结果是17+2/11，也就是说余数是2。</p>
<p>最后：通过对应规则就可以知道余数2对应的数字是X。所以，这是一个合格的身份证号码。</p>
<hr>
<h3 id="附：18位公民身份证编码规则"><a href="#附：18位公民身份证编码规则" class="headerlink" title="附：18位公民身份证编码规则"></a>附：18位公民身份证编码规则</h3><p>18位身份证标准在国家质量技术监督局于1999年7月1日实施的GB11643-1999《公民身份号码》中做了明确规定。GB11643-1999《公民身份号码》为GB11643-1989《社会保障号码》的修订版，其中指出将原标准名称“社会保障号码”更名为“公民身份号码”，另外GB11643-1999《公民身份号码》从实施之日起代替GB11643-1989。公民身份号码是特征组合码，由十七位数字本体码和一位校验码组成。排列顺序从左至右依次为：六位数字地址码，八位数字出生日期码，三位数字顺序码和一位校验码。其含义如下：</p>
<p>1.地址码：表示编码对象常住户口所在县(市、旗、区)的行政区划代码，按GB/T2260的规定执行。</p>
<p>2.出生日期码：表示编码对象出生的年、月、日，按GB/T7408的规定执行，年、月、日分别用4位、2位、2位数字表示，之间不用分隔符。</p>
<p>3.顺序码：表示在同一地址码所标识的区域范围内，对同年、同月、同日出生的人编定的顺序号，顺序码的奇数分配给男性，偶数分配给女性。</p>
<p>校验的计算方式：</p>
<p>1.对前17位数字本体码加权求和</p>
<p>公式为：S=Sum(Ai*Wi),i=0,…,16</p>
<p>其中Ai表示第i位置上的身份证号码数字值，Wi表示第i位置上的加权因子，其各位对应的值依次为：7910584216379105842</p>
<p>2.以11对计算结果取模</p>
<p>Y=mod(S,11)</p>
<p>3.根据模的值得到对应的校验码</p>
<p>对应关系为：</p>
<p>Y值：012345678910</p>
<p>校验码：10X98765432</p>
<h3 id="关于18位身份证号码尾数是“X”的解释"><a href="#关于18位身份证号码尾数是“X”的解释" class="headerlink" title="关于18位身份证号码尾数是“X”的解释"></a>关于18位身份证号码尾数是“X”的解释</h3><p>居民身份证的号码是按照国家的标准编制的，由18位组成：前六位为行政区划代码，第七至第十四位为出生日期码，第15至17位为顺序码，第18位为校验码。作为尾号的校验码，是由号码编制单位按统一的公式计算出来的，如果某人的尾号是0-9，都不会出现X，但如果尾号是10，那么就得用X来代替，因为如果用10做尾号，那么此人的身份证就变成了19位，而19位的号码违反了国家标准，并且我国的计算机应用系统也不承认19位的身份证号码。X是罗马数字的10，用X来代替10，可以保证公民的身份证符合国家标准。但是我国的居民身份证在升位后，一些人的尾号变成了X，这部分人在工作生活中，例如去银行存取钱、去汽车公司租赁汽车或者报名参加考试等等过程中，往往不被检验者理解，认为是假身份证，这样的误会给很多人的生活带来不便。公安局的同志希望领到X身份证的同志正确理解这个数字的含义，查验身份证的机关和单位更应该清楚这一点。</p>
<h3 id="一个简单身份证号尾号校验算法的PHP实现的过程"><a href="#一个简单身份证号尾号校验算法的PHP实现的过程" class="headerlink" title="一个简单身份证号尾号校验算法的PHP实现的过程"></a>一个简单身份证号尾号校验算法的PHP实现的过程</h3><pre><code>&lt;?php
function checkId($id) {
    $len = strlen($id);
    if($len != 18) {
        return 0;
    }
    $a=str_split($id,1);
    $w=array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);
    $c=array(1,0,&apos;X&apos;,9,8,7,6,5,4,3,2);
    $sum = 0;
    for($i=0;$i&lt;17;$i++){
        $sum= $sum + $a[$i]*$w[$i];
    }
    $r=$sum%11;
    $res=$c[$r];
    //echo &quot;校验位是: &quot;.$res;
    if ($res == $a[17]) {
        return 1;
    } else {
        return 0;
    }
}
</code></pre><p>　　</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术日记/" itemprop="url" rel="index">
                    <span itemprop="name">技术日记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hello，World！ 本文开篇第一回</p>
<h2 id="Hello"><a href="#Hello" class="headerlink" title="Hello"></a>Hello</h2><p>“你好”<br>这是自己给自己打个招呼。<br>一直也在“发布”文章，转载的多，原创的少，而且中间换了许多平台，各有优缺点。<br>总的来说就是，发布界面都是傻瓜式的“所见即所得”，但是控制权不够，界面也不可以DIY。</p>
<h2 id="World"><a href="#World" class="headerlink" title="World"></a>World</h2><p>“世界”<br>世界很大，我很渺小。<br>这么多年来也多少攒下一些技术上的经验，可以在这里总结一下。<br>同时，继续学习新的东西，记下学习过程和心得。<br>鞭策自己，警醒自己。</p>
<p>此为开篇也。</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/download-the-application-method-in-the-AppStore-of-overseas-region/" itemprop="url">
                  下载海外地区的AppStore中应用的方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络工具/" itemprop="url" rel="index">
                    <span itemprop="name">网络工具</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>下载海外地区的AppStore中应用的方法</p>
<h3 id="1、官方应用直接下载"><a href="#1、官方应用直接下载" class="headerlink" title="1、官方应用直接下载"></a>1、官方应用直接下载</h3><p>如果是下载指定地区的AppStore中的应用，必须拥有此地区的AppID，然后使用此AppID登录AppStore即可随意下载免费应用。</p>
<p>如果需要下载收费的应用，又没有开通对应的支付方式（例如对应国家地区的信用卡），可以去TB上购买一个Gifts Card充值到账户余额。然后再操作。</p>
<h3 id="2、一些共享AppID的平台"><a href="#2、一些共享AppID的平台" class="headerlink" title="2、一些共享AppID的平台"></a>2、一些共享AppID的平台</h3><p>有专门做这个的网站或者论坛帖子，前几年多些。</p>
<p>还有公众号（例如：野泽科技、绝世废柴、DoMiSo），现在以公众号居多。</p>
<h3 id="3、第三方平台安装"><a href="#3、第三方平台安装" class="headerlink" title="3、第三方平台安装"></a>3、第三方平台安装</h3><p>使用爱思助手或PP助手直接连接电脑安装对应的应用。</p>
<h3 id="4、怎么获得一个美国区的AppID"><a href="#4、怎么获得一个美国区的AppID" class="headerlink" title="4、怎么获得一个美国区的AppID"></a>4、怎么获得一个美国区的AppID</h3><p>这个目前已经有很多方法，而且各种方法都在与时俱进地跟新。可以直接搜索“知乎”等，就有许多可行的方案。
　　</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/Discuz-has-a-solution-that-prompts-no-legal-files-are-uploaded-due-to-high-image-resolution/" itemprop="url">
                  Discuz因图片分辨率过高造成提示“没有合法的文件被上传”的解决方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术日记/" itemprop="url" rel="index">
                    <span itemprop="name">技术日记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>用相机拍的照片的分辨率是特别高的，分辨率达到3000*5000px以上级别，这么高的图片的品质肯定是杠杠的，但在网页上面来讲确实太大了，因为我们普通的网页也用不着展示这么高清这么大的图片。我觉得原因有二：一是因为我们普通的网页确实不需要这么大的；二是这么大的图片通常有好几兆甚至十几兆大小，这样页面的加载速度回很慢的。</p>
<p>我们在Discuz中遇到一个问题，那就是上传某些图片的时候提示“没有合法的文件被上传”，而不是说您上传的文件太大了。想到不合法通常会想到的是图片的格式不对，不是普通的jpg或者png之类的，而是其他的非主流的图片格式。但不管把这样的图片转变成png还是jpg都不能上传，但吧图片一缩小却是可以上传的。这样不就是因为文件大小的问题么？（越大一般来讲文件体积也越大）。但检查后发现文件体积并没有超过网站限制以及对应服务器的php配置。用相机拍的照片的分辨率是特别高的，分辨率达到3000*5000px以上级别，这么高的图片的品质肯定是杠杠的，但在网页上面来讲确实太大了，因为我们普通的网页也用不着展示这么高清这么大的图片。我觉得原因有二：一是因为我们普通的网页确实不需要这么大的；二是这么大的图片通常有好几兆甚至十几兆大小，这样页面的加载速度回很慢的。</p>
<p>我们在Discuz中遇到一个问题，那就是上传某些图片的时候提示“没有合法的文件被上传”，而不是说您上传的文件太大了。想到不合法通常会想到的是图片的格式不对，不是普通的jpg或者png之类的，而是其他的非主流的图片格式。但不管把这样的图片转变成png还是jpg都不能上传，但吧图片一缩小却是可以上传的。这样不就是因为文件大小的问题么？（越大一般来讲文件体积也越大）。但检查后发现文件体积并没有超过网站限制以及对应服务器的</p>
<h3 id="php配置"><a href="#php配置" class="headerlink" title="php配置"></a>php配置</h3><pre><code>function get_image_info($target, $allowswf = false) {
    $ext = discuz_upload::fileext($target);
    $isimage = discuz_upload::is_image_ext($ext);
    if(!$isimage &amp;&amp; ($ext != &apos;swf&apos; || !$allowswf)) {
        return false;
    } elseif(!is_readable($target)) {
        return false;
    } elseif($imageinfo = @getimagesize($target)) {
        list($width, $height, $type) = !empty($imageinfo) ? $imageinfo : array(&apos;&apos;, &apos;&apos;, &apos;&apos;);
        $size = $width * $height;
        if($size &gt; 16777216 || $size &lt; 16 ) {
            return false;
        } elseif($ext == &apos;swf&apos; &amp;&amp; $type != 4 &amp;&amp; $type != 13) {
            return false;
        } elseif($isimage &amp;&amp; !in_array($type, array(1,2,3,6,13))) {
            return false;
        } elseif(!$allowswf &amp;&amp; ($ext == &apos;swf&apos; || $type == 4 || $type == 13)) {
            return false;
        }
        return $imageinfo;
    } else {
        return false;
    }
}
</code></pre><p>这个方法就是获取图片的信息，而返回的值就是真或者假，而为假的时候就提示非法，为真的时候验证通过，上传流程正常执行。而其中就有一个$size变量，它的值是通过获取图片的长宽，然后长宽乘积得到，默认是16777216，开根之后是4096，也就是超过4096×4096px的图片就会之前的报错。而开始的时候我们上传的是5000*4000=2000000，这个值是大于设定的临界的，于是就返回flase。</p>
<p><a href="http://www.muquan.net/article/390.html" target="_blank" rel="external">原文链接</a></p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/customize-your-iPhones-ringtone/" itemprop="url">
                  自定义iPhone的铃声
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/mac使用/" itemprop="url" rel="index">
                    <span itemprop="name">Mac使用</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="需使用Mac电脑上的itunes进行设置。"><a href="#需使用Mac电脑上的itunes进行设置。" class="headerlink" title="需使用Mac电脑上的itunes进行设置。"></a>需使用Mac电脑上的itunes进行设置。</h3><p>具体方法如下：</p>
<p>1、将手机和苹果电脑连接，打开iTunes切换到资料库看“xxx”的iphone这一栏有没有铃声菜单，没有的话点击编辑菜单勾选铃声。</p>
<p>2、下载你喜欢的歌曲点击歌曲-&gt;文件-&gt;添加到资料库，选取要自定义铃声的歌曲之后选择打开。</p>
<p>3、选定歌曲右击-&gt;显示简介-&gt;选项，选择开始停止时间，记得打钩 ( 这里注意的是苹果的铃声只能在40s内 ),然后点击好。</p>
<p>4、选定歌曲文件-&gt;转换-&gt;创建ACC版本，出现两个同名文件。</p>
<p>5、右击刚刚新生成同名文件选择在Finder打开，修改该文件的扩展名为m4r。为了后续操作方便把该文件拖到桌面。</p>
<p>6、返回资料库删除刚刚生成的同名文件。点击音乐-&gt;铃声把刚刚拖到桌面的m4r文件,拖放到列表</p>
<p>7、点击手机按钮进入手机管理。打开手机 设置-&gt;声音与触感-&gt;电话铃声 就可以自定义铃声了。</p>
<p>其中，第2-4步的扩展可以参考如下：</p>
<h3 id="mp3文件到acc文件的剪切与格式转换"><a href="#mp3文件到acc文件的剪切与格式转换" class="headerlink" title="mp3文件到acc文件的剪切与格式转换"></a>mp3文件到acc文件的剪切与格式转换</h3><p>当先打开访达，在访达点击左侧的音乐。</p>
<p>在音乐里面选择一个需要剪切的音频文件，然后右键打开方式为图二的软件即可。</p>
<p>打开软件后点击这个音乐文件，然后看到出现在下方点击名字上的右侧三个小点。并在菜单上选择歌曲信息。</p>
<p>然后在这个信息框点击选项，把开始结束这里勾上。</p>
<p>输入一个需要的时间，即音乐的时长。而后看到这个音乐已经被修改了时长了。例如这里设置为10秒钟，则输入10即可。</p>
<p>然后点击菜单栏上的文件转换，选择创建ACC版本。</p>
<p>这个时候看到在原来的名字下面多个版本，就是创建后的文件，把文件拖到桌面。接着桌面多个剪切后的音频文件了。一个音频文件至此就剪切剪辑完毕了。</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/crawls-pages-text-content/" itemprop="url">
                  抓取网页正文内容
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/技术日记/" itemprop="url" rel="index">
                    <span itemprop="name">技术日记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>近来做了有关抓取网页正文内容（含正文中图片）的功能，这里小结一下。</p>
<p>服务器端语言：PHP</p>
<p>已知：源文章的 URL</p>
<h2 id="1、常规方法"><a href="#1、常规方法" class="headerlink" title="1、常规方法"></a>1、常规方法</h2><p>使用 PHP 内置函数 file_get_contents 或者 CURL 方法直接获取 URL 对应的网页源代码。</p>
<p>这两种方法的使用都很简单，此处不展开讲。注意 CURL 需要模块开启。</p>
<p>问题：可以提取到大部分网页源代码，但是同时也提取到了页面上的其他信息，例如广告、侧栏、通用顶部、通用底部、用户评论等等“噪点数据”，我们其实需要的是“原创文正的正文部分”，不需要其他乱七八糟的内容。</p>
<p>此时，这个源代码就需要进一步处理，使用普通的正则匹配不可用，因为网站内容格式千差万别。如果只是提取固定网站或者有限几个网站的内容，单独进行正则匹配也可凑合使用。这里要介绍的是一种通用的方法，不限网站个数和内容格式，适配几乎所有内容类的网站。</p>
<h2 id="2、进阶方法"><a href="#2、进阶方法" class="headerlink" title="2、进阶方法"></a>2、进阶方法</h2><p>此处需要一个算法，把已经提取到的内容源文件处理一下，计算出正文部分内容（含图片）。</p>
<p>此方法叫做：Readability，一个开源的提取网页正文内容的类。Readability 是一个很不错的实现，它通过遍历Dom对象，通过标签和常用文字的加减权，来重新整合出页面的内容。</p>
<p>JS 版本的 Readability 是最好用的，它可以直接在浏览器完成分析，于是用户还可以人工对分析出来的内容进行修改和校正。</p>
<p>由于 Readability 解决的需求很通用，于是其他语言的程序员纷纷移植了该算法。</p>
<p>PHP 版本 <a href="https://github.com/feelinglucky/php-readability" target="_blank" rel="external">https://github.com/feelinglucky/php-readability</a></p>
<p>Java 版本 <a href="https://github.com/wuman/JReadability" target="_blank" rel="external">https://github.com/wuman/JReadability</a></p>
<p>Node 版本 <a href="https://www.npmjs.org/package/node-readability" target="_blank" rel="external">https://www.npmjs.org/package/node-readability</a></p>
<p>本人就是使用了 PHP 版本的。只是需要与自己的具体业务相结合，需要自己再修改即可，核心算法不变。</p>
<p>这个方法很有效，做内容聚合类的项目很适合（注意版权问题）。</p>
<h2 id="3、特殊方法"><a href="#3、特殊方法" class="headerlink" title="3、特殊方法"></a>3、特殊方法</h2><p>为什么有特殊方法？</p>
<p>因为有些网站有版权保护意识，增加了一些措施防止原创内容被盗取。通常都是图片防盗链，也有正文文字也防盗取的。</p>
<p>此处举2例。</p>
<h3 id="（1）微信公众号文章"><a href="#（1）微信公众号文章" class="headerlink" title="（1）微信公众号文章"></a>（1）微信公众号文章</h3><p>微信公众号文章目前数据量就不用说了，发的人多，看的人超级多，不乏一些优秀的原创。</p>
<p>它这个是要是图片防盗链。提取内容没有问题，但是所有的图片都被防盗链机制过滤掉了。</p>
<p>解决方案：</p>
<p>例如，其中一篇截图：</p>
<p><img src="http://7xi3f2.com1.z0.glb.clouddn.com/sunyi00000.png" alt="蜜糖少女孙怡"></p>
<p>下面对应的图片部分的代码为：</p>
<pre><code>&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; data-src=&quot;http://mmbiz.qpic.cn/mmbiz/9aMpMo0Xap52pCAdiaicq59bbawuXKt0Epws5Qc845SIgM059HHuBIkYpUzl9zUtLLjgwvKjwCkf7VGW6buZAIXQ/0?wx_fmt=jpeg&quot; data-ratio=&quot;1.5&quot; data-w=&quot;&quot; src=&quot;http://mmbiz.qpic.cn/mmbiz/9aMpMo0Xap52pCAdiaicq59bbawuXKt0Epws5Qc845SIgM059HHuBIkYpUzl9zUtLLjgwvKjwCkf7VGW6buZAIXQ/640?wx_fmt=jpeg&amp;amp;tp=webp&amp;amp;wxfrom=5&amp;amp;wx_lazy=1&quot; style=&quot;width: auto !important; visibility: visible !important; height: auto !important;&quot;&gt;
</code></pre><p>其中，src 中的数据是懒加载的同时防盗链，在当前位置到达浏览器窗口时才加载（使用了JS），所以如果直接获取源代码，所有图片属性 src 都是指定的防盗链的静态图片 URL，不是图片的实际 URL。</p>
<p>但是，观察发现，图片实际 URL，已经包括在属性 data-src 中，同时返回了（方便 JS 处理）。</p>
<p>因此，我们在这里替换一次，把所有的图片属性 src 的值替换为图片实际 URL（即 data-src 中的值）即可。 </p>
<pre><code>$text= preg_replace(&quot;/data-src/ie&quot;, &quot;src&quot;, $text);
</code></pre><p>之后，按普通方法继续处理。</p>
<h3 id="（2）36氪文章"><a href="#（2）36氪文章" class="headerlink" title="（2）36氪文章"></a>（2）36氪文章</h3><p>科技媒体36氪文章的保护意识更强，直接抓取，别说图片，连正文文字都获取不到。</p>
<p>这里引用一下 V2EX 上的一篇文章的说法：</p>
<blockquote>
<p>本人使用 PHP 的： file_get_contents 和 curl 函数都未曾获取到。就认真研究了下 36 氪的正文加载过程。</p>
<p>看了一下，它应该是使用 js 加载的正文内容。</p>
<p>如果禁用 js 调试，正文就没有内容；否则，就可以正常显示。但是查看了下所有的 js 文件也没看出来头绪，如果使用“网页另存为”本地文件，再用浏览器打开也是没有正文。</p>
<p>是不是使用了什么加密技术来获取正文（为了防止爬虫）？各位探讨一下</p>
</blockquote>
<p>就是这个意思，我也遇到了同样的问题，不过我怀疑：它的正文时动态加载的。</p>
<p>看了之后，我又去仔细研究了下，得出结论：</p>
<p>因为它的正文内容的确是<strong>使用 JS 动态加载的</strong>。</p>
<p>幸运的是，实际的数据也已经提前随源代码返回来了，只是没有经过 JS 处理，浏览器中不可见而已。</p>
<p>参考截图：</p>
<p><img src="http://7xi3f2.com1.z0.glb.clouddn.com/36krarticle00000.png" alt=""></p>
<p>经过仔细观察发现，可以获取 html 源代码中的 data-dom-id 值为 App-react-component-0 的属性 data-props 的值，就是包含正文内容的 JSON 格式数据。</p>
<p>此处可以使用 DOM 获取，也可以使用正则匹配，本人使用了正则匹配。</p>
<p>正则表达式：</p>
<pre><code>data-dom-id=&quot;App-react-component-0&quot;([\s\S]*?)data-props=[&apos;|\&quot;]([\s\S]*?)[&apos;|\&quot;]\s+data-trace=
</code></pre><p>匹配结果的第2个元素即为包含正文数据的 JSON 格式数据。</p>
<p>之后，把 JSON 格式数据转换为 数组，即可进一步处理。</p>
<pre><code>preg_match(&quot;/data-dom-id=\&quot;App-react-component-0\&quot;([\s\S]*?)data-props=[&apos;|\&quot;]([\s\S]*?)[&apos;|\&quot;]\s+data-trace=/i&quot;, $source, $matches);
$matchesstr = htmlspecialchars_decode($matches[2]);
$matchestarget = json_decode($matchesstr,true);
</code></pre><p>此处注意，转移实体的反转义。否则 JSON 解码函数结果为空。</p>
<h2 id="4、小结"><a href="#4、小结" class="headerlink" title="4、小结"></a>4、小结</h2><p>以上，就是已经用到的方法，总体思路就是：</p>
<p>直接获取 –&gt; 间接获取 –&gt; 正则匹配 –&gt; 替换成可处理格式</p>
<p>不过，这些具体方法本身可能需要随时修正的，具体就看源网站的规则什么时候修改，修改为什么样子了。</p>
<p>掌握核心思考方法和处理机制，任其万变，不离其宗。</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/05/04/centos6.5-build-lnmp/" itemprop="url">
                  CentOS6.5搭建LNMP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2020-05-04T13:05:11+08:00" content="2020-05-04">
              2020-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/web构建/" itemprop="url" rel="index">
                    <span itemprop="name">Web构建</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>CentOS6.5搭建LNMP  </p>
<h3 id="1：查看环境："><a href="#1：查看环境：" class="headerlink" title="1：查看环境："></a>1：查看环境：</h3><pre><code>[root@10-4-14-168 html]# cat /etc/redhat-release
CentOS release 6.5 (Final)
</code></pre><h3 id="2：关掉防火墙"><a href="#2：关掉防火墙" class="headerlink" title="2：关掉防火墙"></a>2：关掉防火墙</h3><pre><code>[root@10-4-14-168 html]# chkconfig iptables off
</code></pre><h3 id="3：配置CentOS-6-0-第三方yum源（CentOS默认的标准源里没有nginx软件包）"><a href="#3：配置CentOS-6-0-第三方yum源（CentOS默认的标准源里没有nginx软件包）" class="headerlink" title="3：配置CentOS 6.0 第三方yum源（CentOS默认的标准源里没有nginx软件包）"></a>3：配置CentOS 6.0 第三方yum源（CentOS默认的标准源里没有nginx软件包）</h3><pre><code>#wget http://www.atomicorp.com/installers/atomic
#sh ./atomic
#yum check-update
</code></pre><h3 id="4：安装开发包和库文件"><a href="#4：安装开发包和库文件" class="headerlink" title="4：安装开发包和库文件　"></a>4：安装开发包和库文件　</h3><pre><code>#yum -y install ntp make openssl openssl-devel pcre pcre-devel libpng
libpng-devel libjpeg-6b libjpeg-devel-6b freetype freetype-devel gd gd-devel zlib zlib-devel
gcc gcc-c++ libXpm libXpm-devel ncurses ncurses-devel libmcrypt libmcrypt-devel libxml2
libxml2-devel imake autoconf automake screen sysstat compat-libstdc++-33 curl curl-devel
</code></pre><h3 id="5：卸载已安装的apache、mysql、php"><a href="#5：卸载已安装的apache、mysql、php" class="headerlink" title="5：卸载已安装的apache、mysql、php"></a>5：卸载已安装的apache、mysql、php</h3><pre><code># yum remove httpd
# yum remove mysql
# yum remove php
</code></pre><h3 id="6：安装nginx"><a href="#6：安装nginx" class="headerlink" title="6：安装nginx"></a>6：安装nginx</h3><pre><code># yum install nginx
# service nginx start
# chkconfig --levels 235 nginx on
//设2、3、5级别开机启动
</code></pre><h3 id="7：安装mysql"><a href="#7：安装mysql" class="headerlink" title="7：安装mysql"></a>7：安装mysql</h3><pre><code># yum install mysql mysql-server mysql-devel
# service mysqld start
# chkconfig --levels 235 mysqld on
</code></pre><p>登陆MySQL删除空用户，修改root密码<br>    mysql&gt;select user,host,password from mysql.user;</p>
<pre><code>mysql&gt;drop user &apos;&apos;@localhost;

mysql&gt;update mysql.user set password = PASSWORD(&apos;*********&apos;) where user=&apos;root&apos;;

mysql&gt;flush privileges;
</code></pre><p>　　</p>
<h3 id="8：安装php"><a href="#8：安装php" class="headerlink" title="8：安装php"></a>8：安装php</h3><pre><code># yum install php lighttpd-fastcgi php-cli php-mysql php-gd php-imap php-ldap
php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mcrypt php-mssql php-snmp php-soap
</code></pre><p>//安装php和所需组件使PHP支持MySQL、FastCGI模式</p>
<pre><code>#yum install  php-tidy php-common php-devel php-fpm php-mysql

# service php-fpm start
# chkconfig --levels 235 php-fpm on
</code></pre><h3 id="9：配置nginx支持php"><a href="#9：配置nginx支持php" class="headerlink" title="9：配置nginx支持php"></a>9：配置nginx支持php</h3><pre><code># mv /etc/nginx/nginx.conf /etc/nginx/nginx.confbak
//将配置文件改为备份文件

# cp /etc/nginx/nginx.conf.default /etc/nginx/nginx.conf
//由于原配置文件要自己去写因此可以使用默认的配置文件作为配置文件

//修改nginx配置文件，添加fastcgi支持
# vi /etc/nginx/nginx.conf
index index.php index.html index.htm;
//加入index.php

location ~ \.php$ {
            root           /usr/share/nginx/html;
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  /usr/share/nginx/html$fastcgi_script_name;
            include        fastcgi_params;
    }

//将以上代码注释去掉，并修改成nginx默认路径
</code></pre><h3 id="10：配置php"><a href="#10：配置php" class="headerlink" title="10：配置php"></a>10：配置php</h3><p>//编辑文件php.ini，在文件末尾添加cgi.fix_pathinfo = 1<br>    [root@CentOS ~]# vi /etc/php.ini</p>
<h3 id="11：重启nginx-php-fpm"><a href="#11：重启nginx-php-fpm" class="headerlink" title="11：重启nginx php-fpm"></a>11：重启nginx php-fpm</h3><pre><code># service nginx restart
# service php-fpm restart
</code></pre><p>　　</p>
<h3 id="12：建立info-php文件"><a href="#12：建立info-php文件" class="headerlink" title="12：建立info.php文件"></a>12：建立info.php文件</h3><pre><code># vi /usr/share/nginx/html/info.php

&lt;?php
   phpinfo();
?&gt;
</code></pre><p>　　</p>
<h3 id="13：测试nginx是否解析php"><a href="#13：测试nginx是否解析php" class="headerlink" title="13：测试nginx是否解析php"></a>13：测试nginx是否解析php</h3><p>本地浏览器输入：</p>
<pre><code>192.168.1.105/info.php
</code></pre><p>显示php界面  环境搭建成功
　　</p>

          
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="isunman" />
          <p class="site-author-name" itemprop="name">isunman</p>
          <p class="site-description motion-element" itemprop="description">love IT, love Movie, love Love</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">70</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">40</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/isunman" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/" target="_blank">知乎</a>
              </span>
            
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">isunman</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="powered-by">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>
<div class="theme-info">
<span id="busuanzi_container_site_pv">
    PV<span id="busuanzi_value_site_pv"></span> --
</span>
<span id="busuanzi_container_site_uv">
  UV<span id="busuanzi_value_site_uv"></span>
</span>
</div>


      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  


  



  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  



  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  


  

</body>
</html>
